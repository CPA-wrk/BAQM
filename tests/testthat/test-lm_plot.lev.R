test_options <- list(scipen = 2, digits = 6, width = 90, max.print = 10000)

test_that("lm_plot.lev produces expected plot elements for cars", {
  withr::local_options(test_options)
  fit <- lm(mpg ~ wt + hp, data = mtcars)
  set.seed(123)
  lm_plot.lev_cars <- lm_plot.lev(mdl = fit, opt = list(cook.loess = TRUE))
  # Delete plot graphics and mdl from output for test
  lm_plot.lev_cars.out <- list()
  nms <- names(lm_plot.lev_cars)
  for (nm in nms[!nms %in% c("mdl", "plts", "p_4way")]) {
    lm_plot.lev_cars.out[[nm]] <-
      testthat::capture_output_lines(print(lm_plot.lev_cars[[nm]]))
  }
  # lm_plot.lev_cars.txt <- lm_plot.lev_cars.out
  # dump("lm_plot.lev_cars.txt", file = "chk/lm_plot.lev_cars.txt")
  lm_plot.lev_cars.txt <- list(
    opt = c("$cook.loess", "[1] TRUE", ""),
    parm = c("$pts",
             "$pts$symsz", "[1] 1.5", "", "$pts$lblsz", "[1] 2.25", "", "$pts$shape",
             "$pts$shape$reg", "[1] \"circle\"", "", "$pts$shape$outl", "[1] \"circle open\"",
             "", "$pts$shape$cook", "[1] \"square open\"", "", "", "$pts$colr",
             "$pts$colr$reg", "[1] \"black\"", "", "$pts$colr$outl", "[1] \"red\"",
             "", "$pts$colr$cook", "[1] \"green4\"", "", "$pts$colr$infl",
             "[1] \"green4\"", "", "", "$pts$id", "$pts$id$reg", "[1] FALSE",
             "", "$pts$id$outl", "[1] TRUE", "", "$pts$id$cook", "[1] TRUE",
             "", "$pts$id$infl", "[1] TRUE", "", "", "$pts$offp", "$pts$offp$infl",
             "[1] 0.01", "", "", "", "$lins", "$lins$size", "[1] 0.5", "",
             "$lins$size_lg", "[1] 1", "", "$lins$notesz", "[1] 3.5", "",
             "$lins$ltyp", "$lins$ltyp$fit", "[1] \"solid\"", "", "$lins$ltyp$pi",
             "[1] \"dashed\"", "", "$lins$ltyp$qq", "[1] \"solid\"", "", "$lins$ltyp$var",
             "[1] \"dashed\"", "", "$lins$ltyp$ac", "[1] \"solid\"", "", "$lins$ltyp$lev",
             "[1] \"dotted\"", "", "$lins$ltyp$infl", "[1] \"dotted\"", "",
             "$lins$ltyp$cook", "[1] \"dotted\"", "", "", "$lins$colr", "$lins$colr$fit",
             "[1] \"orange\"", "", "$lins$colr$qq", "[1] \"dodgerblue\"",
             "", "$lins$colr$var", "[1] \"purple\"", "", "$lins$colr$ac",
             "[1] \"green4\"", "", "$lins$colr$lev", "[1] \"green4\"", "",
             "$lins$colr$infl", "[1] \"green4\"", "", "$lins$colr$cook", "[1] \"gray70\"",
             "", "", "", "$seed", "$seed$ac", "$seed$ac$outl", "[1] 123",
             "", "$seed$ac$reg", "[1] 123", "", "", "$seed$fit", "$seed$fit$outl",
             "[1] 123", "", "$seed$fit$reg", "[1] 123", "", "", "$seed$infl",
             "$seed$infl$infl", "[1] 123", "", "$seed$infl$outl", "[1] 123",
             "", "$seed$infl$reg", "[1] 123", "", "", "$seed$lev", "$seed$lev$lev",
             "[1] 123", "", "$seed$lev$outl", "[1] 123", "", "$seed$lev$reg",
             "[1] 123", "", "", "$seed$qq", "$seed$qq$outl", "[1] 123", "",
             "$seed$qq$reg", "[1] 123", "", "", "$seed$var", "$seed$var$outl",
             "[1] 123", "", "$seed$var$reg", "[1] 123", "", "", "", "$cook",
             "$cook$n", "[1] 100", "", "$cook$level", "pos.0.5 neg.0.5   pos.1   neg.1 ",
             "    0.5    -0.5     1.0    -1.0 ", "", "$cook$labl", "   pos.0.5    neg.0.5      pos.1      neg.1 ",
             "\"d = +0.5\" \"d = -0.5\"   \"d = +1\"   \"d = -1\" ", "", "$cook$cont",
             "    pos.0.5  neg.0.5   pos.1    neg.1         x", "1   6.58883 -6.58883 9.31801 -9.31801 0.0333981",
             "2   6.24770 -6.24770 8.83558 -8.83558 0.0370062", "3   5.95254 -5.95254 8.41817 -8.41817 0.0406143",
             "4   5.69381 -5.69381 8.05226 -8.05226 0.0442224", "5   5.46450 -5.46450 7.72796 -7.72796 0.0478305",
             "6   5.25937 -5.25937 7.43787 -7.43787 0.0514386", "7   5.07440 -5.07440 7.17629 -7.17629 0.0550467",
             "8   4.90646 -4.90646 6.93878 -6.93878 0.0586548", "9   4.75304 -4.75304 6.72181 -6.72181 0.0622629",
             "10  4.61213 -4.61213 6.52254 -6.52254 0.0658710", "11  4.48210 -4.48210 6.33865 -6.33865 0.0694791",
             "12  4.36158 -4.36158 6.16821 -6.16821 0.0730872", "13  4.24946 -4.24946 6.00964 -6.00964 0.0766953",
             "14  4.14477 -4.14477 5.86160 -5.86160 0.0803034", "15  4.04672 -4.04672 5.72293 -5.72293 0.0839115",
             "16  3.95462 -3.95462 5.59268 -5.59268 0.0875196", "17  3.86787 -3.86787 5.46999 -5.46999 0.0911277",
             "18  3.78596 -3.78596 5.35416 -5.35416 0.0947358", "19  3.70845 -3.70845 5.24454 -5.24454 0.0983439",
             "20  3.63494 -3.63494 5.14058 -5.14058 0.1019520", "21  3.56510 -3.56510 5.04181 -5.04181 0.1055601",
             "22  3.49861 -3.49861 4.94778 -4.94778 0.1091682", "23  3.43521 -3.43521 4.85812 -4.85812 0.1127763",
             "24  3.37466 -3.37466 4.77249 -4.77249 0.1163844", "25  3.31674 -3.31674 4.69058 -4.69058 0.1199925",
             "26  3.26127 -3.26127 4.61213 -4.61213 0.1236006", "27  3.20806 -3.20806 4.53688 -4.53688 0.1272087",
             "28  3.15696 -3.15696 4.46462 -4.46462 0.1308168", "29  3.10784 -3.10784 4.39514 -4.39514 0.1344249",
             "30  3.06055 -3.06055 4.32827 -4.32827 0.1380330", "31  3.01499 -3.01499 4.26383 -4.26383 0.1416411",
             "32  2.97104 -2.97104 4.20168 -4.20168 0.1452492", "33  2.92861 -2.92861 4.14168 -4.14168 0.1488573",
             "34  2.88761 -2.88761 4.08370 -4.08370 0.1524654", "35  2.84796 -2.84796 4.02762 -4.02762 0.1560735",
             "36  2.80957 -2.80957 3.97333 -3.97333 0.1596816", "37  2.77239 -2.77239 3.92075 -3.92075 0.1632897",
             "38  2.73634 -2.73634 3.86976 -3.86976 0.1668978", "39  2.70136 -2.70136 3.82030 -3.82030 0.1705059",
             "40  2.66740 -2.66740 3.77228 -3.77228 0.1741140", "41  2.63441 -2.63441 3.72563 -3.72563 0.1777221",
             "42  2.60235 -2.60235 3.68027 -3.68027 0.1813302", "43  2.57115 -2.57115 3.63615 -3.63615 0.1849383",
             "44  2.54079 -2.54079 3.59322 -3.59322 0.1885464", "45  2.51122 -2.51122 3.55140 -3.55140 0.1921545",
             "46  2.48241 -2.48241 3.51065 -3.51065 0.1957626", "47  2.45432 -2.45432 3.47093 -3.47093 0.1993707",
             "48  2.42692 -2.42692 3.43218 -3.43218 0.2029788", "49  2.40018 -2.40018 3.39437 -3.39437 0.2065869",
             "50  2.37407 -2.37407 3.35745 -3.35745 0.2101950", "51  2.34857 -2.34857 3.32139 -3.32139 0.2138031",
             "52  2.32365 -2.32365 3.28614 -3.28614 0.2174112", "53  2.29929 -2.29929 3.25169 -3.25169 0.2210193",
             "54  2.27546 -2.27546 3.21799 -3.21799 0.2246274", "55  2.25215 -2.25215 3.18501 -3.18501 0.2282355",
             "56  2.22932 -2.22932 3.15274 -3.15274 0.2318436", "57  2.20697 -2.20697 3.12113 -3.12113 0.2354517",
             "58  2.18508 -2.18508 3.09017 -3.09017 0.2390598", "59  2.16363 -2.16363 3.05983 -3.05983 0.2426679",
             "60  2.14260 -2.14260 3.03009 -3.03009 0.2462760", "61  2.12198 -2.12198 3.00093 -3.00093 0.2498841",
             "62  2.10175 -2.10175 2.97232 -2.97232 0.2534922", "63  2.08190 -2.08190 2.94425 -2.94425 0.2571003",
             "64  2.06241 -2.06241 2.91669 -2.91669 0.2607084", "65  2.04328 -2.04328 2.88964 -2.88964 0.2643165",
             "66  2.02450 -2.02450 2.86307 -2.86307 0.2679246", "67  2.00604 -2.00604 2.83697 -2.83697 0.2715327",
             "68  1.98790 -1.98790 2.81132 -2.81132 0.2751408", "69  1.97007 -1.97007 2.78610 -2.78610 0.2787490",
             "70  1.95254 -1.95254 2.76131 -2.76131 0.2823571", "71  1.93530 -1.93530 2.73693 -2.73693 0.2859652",
             "72  1.91834 -1.91834 2.71295 -2.71295 0.2895733", "73  1.90165 -1.90165 2.68934 -2.68934 0.2931814",
             "74  1.88523 -1.88523 2.66612 -2.66612 0.2967895", "75  1.86906 -1.86906 2.64325 -2.64325 0.3003976",
             "76  1.85314 -1.85314 2.62073 -2.62073 0.3040057", "77  1.83746 -1.83746 2.59856 -2.59856 0.3076138",
             "78  1.82201 -1.82201 2.57671 -2.57671 0.3112219", "79  1.80679 -1.80679 2.55518 -2.55518 0.3148300",
             "80  1.79178 -1.79178 2.53397 -2.53397 0.3184381", "81  1.77700 -1.77700 2.51305 -2.51305 0.3220462",
             "82  1.76242 -1.76242 2.49243 -2.49243 0.3256543", "83  1.74804 -1.74804 2.47210 -2.47210 0.3292624",
             "84  1.73386 -1.73386 2.45204 -2.45204 0.3328705", "85  1.71987 -1.71987 2.43226 -2.43226 0.3364786",
             "86  1.70606 -1.70606 2.41273 -2.41273 0.3400867", "87  1.69244 -1.69244 2.39347 -2.39347 0.3436948",
             "88  1.67899 -1.67899 2.37445 -2.37445 0.3473029", "89  1.66571 -1.66571 2.35567 -2.35567 0.3509110",
             "90  1.65260 -1.65260 2.33713 -2.33713 0.3545191", "91  1.63965 -1.63965 2.31882 -2.31882 0.3581272",
             "92  1.62686 -1.62686 2.30073 -2.30073 0.3617353", "93  1.61423 -1.61423 2.28286 -2.28286 0.3653434",
             "94  1.60174 -1.60174 2.26520 -2.26520 0.3689515", "95  1.58940 -1.58940 2.24776 -2.24776 0.3725596",
             "96  1.57721 -1.57721 2.23051 -2.23051 0.3761677", "97  1.56515 -1.56515 2.21346 -2.21346 0.3797758",
             "98  1.55323 -1.55323 2.19660 -2.19660 0.3833839", "99  1.54144 -1.54144 2.17993 -2.17993 0.3869920",
             "100 1.52979 -1.52979 2.16344 -2.16344 0.3906001", "101 1.51825 -1.51825 2.14714 -2.14714 0.3942082",
             "", "", "$xtrem", "$xtrem$infl", "$xtrem$infl$meas", "[1] \".cooksd\"",
             "", "$xtrem$infl$thrshld", "[1] 0.807525", "", "", "$xtrem$lev",
             "$xtrem$lev$meas", "[1] \".hat\"", "", "$xtrem$lev$thrshld",
             "[1] 0.1875", "", "", "$xtrem$outl", "$xtrem$outl$meas", "[1] \"boxplot\"",
             "", "$xtrem$outl$thrshld", "[1] 1.5", "", "", ""),
    df = c("                                    .id .sequence .obs    .fits     .resid",
           "Mazda RX4                     Mazda RX4         1 21.0 23.57233 -2.5723294",
           "Mazda RX4 Wag             Mazda RX4 Wag         2 21.0 22.58348 -1.5834826",
           "Datsun 710                   Datsun 710         3 22.8 25.27582 -2.4758187",
           "Hornet 4 Drive           Hornet 4 Drive         4 21.4 21.26502  0.1349799",
           "Hornet Sportabout     Hornet Sportabout         5 18.7 18.32727  0.3727334",
           "Valiant                         Valiant         6 18.1 20.47382 -2.3738163",
           "Duster 360                   Duster 360         7 14.3 15.59904 -1.2990424",
           "Merc 240D                     Merc 240D         8 24.4 22.88707  1.5129327",
           "Merc 230                       Merc 230         9 22.8 21.99367  0.8063267",
           "Merc 280                       Merc 280        10 19.2 19.97946 -0.7794599",
           "Merc 280C                     Merc 280C        11 17.8 19.97946 -2.1794599",
           "Merc 450SE                   Merc 450SE        12 16.4 15.72537  0.6746315",
           "Merc 450SL                   Merc 450SL        13 17.3 17.04383  0.2561690",
           "Merc 450SLC                 Merc 450SLC        14 15.2 16.84994 -1.6499395",
           "Cadillac Fleetwood   Cadillac Fleetwood        15 10.4 10.35520  0.0447954",
           "Lincoln Continental Lincoln Continental        16 10.4  9.36273  1.0372674",
           "Chrysler Imperial     Chrysler Imperial        17 14.7  9.19249  5.5075130",
           "Fiat 128                       Fiat 128        18 32.4 26.59903  5.8009720",
           "Honda Civic                 Honda Civic        19 30.4 29.31238  1.0876198",
           "Toyota Corolla           Toyota Corolla        20 33.9 28.04621  5.8537908",
           "Toyota Corona             Toyota Corona        21 21.5 24.58644 -3.0864415",
           "Dodge Challenger       Dodge Challenger        22 15.5 18.81136 -3.3113639",
           "AMC Javelin                 AMC Javelin        23 15.2 19.14098 -3.9409795",
           "Camaro Z28                   Camaro Z28        24 13.3 14.55203 -1.2520281",
           "Pontiac Firebird       Pontiac Firebird        25 19.2 16.75675  2.4432548",
           "Fiat X1-9                     Fiat X1-9        26 27.3 27.62665 -0.3266531",
           "Porsche 914-2             Porsche 914-2        27 26.0 26.03737 -0.0373742",
           "Lotus Europa               Lotus Europa        28 30.4 27.76977  2.6302308",
           "Ford Pantera L           Ford Pantera L        29 15.8 16.54649 -0.7464887",
           "Ferrari Dino               Ferrari Dino        30 19.7 20.92541 -1.2254132",
           "Maserati Bora             Maserati Bora        31 15.0 12.73948  2.2605229",
           "Volvo 142E                   Volvo 142E        32 21.4 22.98365 -1.5836494",
           "                     .se.fit .lower.pi .upper.pi .std.resid .stud.resid",
           "Mazda RX4           0.545708  18.15205   28.9926 -1.0145865  -1.0151193",
           "Mazda RX4 Wag       0.521828  17.17305   27.9939 -0.6233275  -0.6166309",
           "Datsun 710          0.636317  19.81437   30.7373 -0.9847588  -0.9842273",
           "Hornet 4 Drive      0.565072  15.83645   26.6936  0.0533285   0.0524035",
           "Hornet Sportabout   0.497927  12.92627   23.7283  0.1464478   0.1439539",
           "Valiant             0.672044  14.99450   25.9531 -0.9476980  -0.9459788",
           "Duster 360          0.887142   9.99317   21.2049 -0.5330590  -0.5263728",
           "Merc 240D           0.881974  17.28461   28.4895  0.6203511   0.6136467",
           "Merc 230            0.635340  16.53270   27.4546  0.3206856   0.3156682",
           "Merc 280            0.561705  14.55235   25.4066 -0.3078616  -0.3030026",
           "Merc 280C           0.561705  14.55235   25.4066 -0.8608166  -0.8568628",
           "Merc 450SE          0.614784  10.27425   21.1765  0.2677652   0.2634339",
           "Merc 450SL          0.526636  11.63145   22.4562  0.1008787   0.0991415",
           "Merc 450SLC         0.535104  11.43409   22.2658 -0.6501951  -0.6435948",
           "Cadillac Fleetwood  1.117791   4.57938   16.1310  0.0191421   0.0188093",
           "Lincoln Continental 1.185556   3.53066   15.1948  0.4497023   0.4434296",
           "Chrysler Imperial   1.119943   3.41492   14.9701  2.3545172   2.5724776",
           "Fiat 128            0.733114  21.08705   32.1110  2.3319225   2.5420600",
           "Honda Civic         0.909390  23.69162   34.9331  0.4478117   0.4415524",
           "Toyota Corolla      0.818070  22.48445   33.6080  2.3786178   2.6051516",
           "Toyota Corona       0.597224  19.14349   30.0294 -1.2229783  -1.2339492",
           "Dodge Challenger    0.490124  13.41335   24.2094 -1.3002686  -1.3166089",
           "AMC Javelin         0.473950  13.74901   24.5329 -1.5456419  -1.5854676",
           "Camaro Z28          0.832260   8.98147   20.1226 -0.5097331  -0.5031265",
           "Pontiac Firebird    0.547285  11.33580   22.1777  0.9638057   0.9625847",
           "Fiat X1-9           0.787697  22.08327   33.1700 -0.1322004  -0.1299402",
           "Porsche 914-2       0.689973  20.54874   31.5260 -0.0149500  -0.0146900",
           "Lotus Europa        1.016542  22.07273   33.4668  1.1024151   1.1066785",
           "Ford Pantera L      1.172566  10.72541   22.3676 -0.3227088  -0.3176670",
           "Ferrari Dino        0.671521  15.44636   26.4045 -0.4891940  -0.4826813",
           "Maserati Bora       1.628299   6.47655   19.0024  1.1198909   1.1250084",
           "Volvo 142E          0.527721  17.57083   28.3965 -0.6236921  -0.6169965",
           "                          .cooksd      .hat  .quantile .is.outl .is.infl",
           "Mazda RX4           0.01589652330 0.0442769 -1.2298588      reg      reg",
           "Mazda RX4 Wag       0.00546477876 0.0404867 -0.5334097      reg      reg",
           "Datsun 710          0.02070651436 0.0602010 -1.0775156      reg      reg",
           "Hornet 4 Drive      0.00004724822 0.0474749  0.1970991      reg      reg",
           "Hornet Sportabout   0.00027361842 0.0368629  0.3601299      reg      reg",
           "Valiant             0.02155063669 0.0671510 -0.9467818      reg      reg",
           "Duster 360          0.01255218254 0.1170154 -0.4450965      reg      reg",
           "Merc 240D           0.01677650160 0.1156562  0.8305109      reg      reg",
           "Merc 230            0.00218870150 0.0600163  0.5334097      reg      reg",
           "Merc 280            0.00155499617 0.0469108 -0.1970991      reg      reg",
           "Merc 280C           0.01215736752 0.0469108 -0.8305109      reg      reg",
           "Merc 450SE          0.00142300757 0.0561956  0.4450965      reg      reg",
           "Merc 450SL          0.00014589596 0.0412361  0.2776904      reg      reg",
           "Merc 450SLC         0.00626604928 0.0425729 -0.7245144      reg      reg",
           "Cadillac Fleetwood  0.00002786686 0.1857711  0.1177699      reg      reg",
           "Lincoln Continental 0.01780909824 0.2089784  0.6260990      reg      reg",
           "Chrysler Imperial   0.42361090162 0.1864872  1.4177971     outl     outl",
           "Fiat 128            0.15742628949 0.0799099  1.6759397     outl     outl",
           "Honda Civic         0.00937144586 0.1229581  0.7245144      reg      reg",
           "Toyota Corolla      0.20839325973 0.0995033  2.1538747     outl     outl",
           "Toyota Corona       0.02791981732 0.0530313 -1.4177971      reg      reg",
           "Dodge Challenger    0.02087418858 0.0357165 -1.6759397      reg      reg",
           "AMC Javelin         0.02751509883 0.0333981 -2.1538747      reg      reg",
           "Camaro Z28          0.00994352707 0.1029854 -0.3601299      reg      reg",
           "Pontiac Firebird    0.01443198523 0.0445332  1.0775156      reg      reg",
           "Fiat X1-9           0.00059204395 0.0922519 -0.0391761      reg      reg",
           "Porsche 914-2       0.00000567499 0.0707818  0.0391761      reg      reg",
           "Lotus Europa        0.07353984998 0.1536413  1.2298588      reg      reg",
           "Ford Pantera L      0.00891970082 0.2044239 -0.1177699      reg      reg",
           "Ferrari Dino        0.00573267216 0.0670465 -0.2776904      reg      reg",
           "Maserati Bora       0.27203974871 0.3942082  0.9467818      reg      reg",
           "Volvo 142E          0.00560080368 0.0414062 -0.6260990      reg      reg",
           "                    .is.lev", "Mazda RX4               reg",
           "Mazda RX4 Wag           reg", "Datsun 710              reg",
           "Hornet 4 Drive          reg", "Hornet Sportabout       reg",
           "Valiant                 reg", "Duster 360              reg",
           "Merc 240D               reg", "Merc 230                reg",
           "Merc 280                reg", "Merc 280C               reg",
           "Merc 450SE              reg", "Merc 450SL              reg",
           "Merc 450SLC             reg", "Cadillac Fleetwood      reg",
           "Lincoln Continental     lev", "Chrysler Imperial      outl",
           "Fiat 128               outl", "Honda Civic             reg",
           "Toyota Corolla         outl", "Toyota Corona           reg",
           "Dodge Challenger        reg", "AMC Javelin             reg",
           "Camaro Z28              reg", "Pontiac Firebird        reg",
           "Fiat X1-9               reg", "Porsche 914-2           reg",
           "Lotus Europa            reg", "Ford Pantera L          lev",
           "Ferrari Dino            reg", "Maserati Bora           lev",
           "Volvo 142E              reg"))
  expect_equal(lm_plot.lev_cars.out, lm_plot.lev_cars.txt)
})
